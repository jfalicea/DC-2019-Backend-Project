<% include dbhead %>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
<body>
    <div class="main-container" id="<%= resume %>">
        <a href="/users/logout" class="logout"><img src="https://img.icons8.com/android/30/000000/logout-rounded.png"></a>
    <% include navbar %>
    <form class="hidden" id="input_form" action="/users/database/update" method="post">
        <div class="input_fields">

            <input type="text" name="first_name" class="form-control" placeholder="First Name">

            <input type="text" name="last_name" class="form-control" placeholder="Last Name">

            <input type="text" name="email" class="form-control" placeholder="Email">

            <select name="user_role" class="form-control">
                <option value="false">Employee</option>
                <option value="true">Admin</option>
            </select>

            <select name="emp_status" class="form-control">
                <option value="true">Active</option>
                <option value="false">Inactive</option>
            </select>
        
            <div class="button-div">
                <input type="submit" class="btn btn-secondary" id="newfirst" value="SUBMIT">
            </div>

        </div>
    </form>
        <div class="small-container">
            <div class="label" id="<%= user_email %>">
                employees
            </div>
            <br>
            <div class="database">
                    <div class="row">
                        <div class="data-col">
                            <div class="table-headers">
                                First Name<hr>
                            </div>
                        </div>
                        <div class="data-col">
                            <div class="table-headers">
                                Last Name<hr>
                            </div>
                        </div>
                        <div class="data-col">
                            <div class="table-headers">
                                Email<hr>
                            </div>
                        </div>
                        <div class="data-col">
                            <div class="table-headers">
                                User Role<hr>
                            </div>
                        </div>
                        <div class="data-col">
                            <div class="table-headers">
                                Status<hr>
                            </div>
                        </div>
                    </div>   
                    <!-- <div class="table-headers"> -->
                <% userData.forEach(({ first_name, last_name, email, user_role, emp_status }) => { %>
                    <div class="row">
                        <div class="data-col">
                            <a href="/users/remove/?email=<%= email %>" class="remove-data hidden" id="<%= email %>">
                                <img src="https://img.icons8.com/flat_round/20/000000/delete-sign.png">
                            </a>
                            <input class="data-change" placeholder="<%= first_name %>" readonly>
                        </div>
                        <div class="data-col" contenteditable="true">
                            <input class="data-change" placeholder="<%= last_name %>" readonly>
                        </div>
                        <div class="data-col">
                            <input class="data-change" placeholder="<%= email %>" readonly>
                        </div>
                        <div class="data-col">
                            <input class="data-change roles" id="<%= user_role %>" readonly>
                        </div>
                        <div class="data-col">
                            <input class="data-change status" id="<%= emp_status %>" readonly>
                        </div>
                    </div>               
                <% }) %>
            </div>
        </div>
    </div>
<script>
$(document).ready(function () {

    const $toggles = $('form');
    const $data = $('.remove-data');
    const $page = $('.main-container');
    const $self = $('.label');

    const roles = document.querySelectorAll('.roles');
    const status = document.querySelectorAll('.status');
    const values = document.querySelectorAll('.remove-data');
    const edits = document.querySelectorAll('.data-change');

    console.log($self.attr('id'));

    values.forEach((value) => {
   
        if (value.id === $self.attr('id')) {
            value.style.display = 'none'
        }

    });

    roles.forEach((role) => {

        if (role.id === 'true') {
            console.log('hey');
            role.setAttribute('placeholder', 'Admin');
        } else if (role.id === 'false') {
            role.setAttribute('placeholder', 'Employee');
        }

    });

    status.forEach((status) => {

        if (status.id === 'true') {
            status.setAttribute('placeholder', 'Active')
        } else if (status.id === 'false') {
            status.setAttribute('placeholder', 'Inactive')
        }

    })

    if ($page.attr('id') === 'true') {
        $data.removeClass('hidden');
    }

    const controlClick = (e) => {

        const el = e.target;

        if (el.id === 'add') {            
            $toggles.toggleClass('hidden');
            $('#add').toggleClass('red');
        } else if (el.id === 'remove') {
            $data.toggleClass('hidden');
            if ($data.hasClass('hidden')) {
                $('#remove').removeClass('red');
            } else {
                $('#remove').addClass('red');
            }
        } else if (el.id === 'update') {
            $('#update').toggleClass('red');
            if($('#update').hasClass('red') === true) {
                $('.data-change').removeAttr('readonly');
                $('.data-change').css('cursor','text')
            } else {
                $('.data-change').attr('readonly', 'true');
                $('.data-change').css('cursor','default');
            }
        } else if (el.id === 'settings') {
            $('#settings').toggleClass('red');
        }

    }


    window.addEventListener('click', controlClick);

});
</script>
</body>
</html>